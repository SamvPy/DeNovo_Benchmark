from ..converters import DenovoEngineConverter
from ..io import psmlist_to_mgf
from ..constants import MODIFICATION_MAPPING_TO_SPECTRALIS
import argparse

def main(args):

    denovo_engine = DenovoEngineConverter.select(label=args.denovo_engine)
    psmlist = denovo_engine.parse(
        result_path=args.result_path,
        mgf_path=args.mgf_path
    )
    

    psmlist_to_mgf(
        psmlist=psmlist,
        mgf_path=args.mgf_file,
        output_folder=args.output_folder,
        modification_mapping=MODIFICATION_MAPPING_TO_SPECTRALIS,
        exclusion_list=args.exclusion_list,
        annotated=True
    )


if __name__ == "__main__":

    parser = argparse.ArgumentParser(description="Write mgf files, annotated by a given de novo search")
    parser.add_argument('-r', '--search_result', required=True, help="Path to result file generated by a de novo search engine.")
    parser.add_argument('-m', '--mgf_file', required=True, help="Path to unannotated mgf-file")
    parser.add_argument('-d', '--denovo_engine', required=True, help="The denovo engine used to generate the files search result file.")
    parser.add_argument('-o', '--output_folder', default="", help="Output folder to store annotated mgf-file")
    parser.add_argument('-x', '--exclusion_list', default=[], help="List containing tags in peptides that should be dropped (e. g. modification tags...)")

    args = parser.parse_args()

    main(args)